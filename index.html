<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premier League Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        .form-box { 
            width: 20px; 
            height: 20px; 
            border-radius: 3px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 9px; 
            font-weight: bold; 
        }
        .stat-bar {
            height: 4px;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        .day-column {
            min-width: 200px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Icons
        const RefreshCw = ({ spinning }) => (
            <svg className={`w-4 h-4 ${spinning ? 'animate-spin' : ''}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"/>
            </svg>
        );
        
        const Trophy = () => (
            <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
            </svg>
        );
        
        const ChevronDown = ({ isOpen }) => (
            <svg className={`w-3 h-3 transition-transform ${isOpen ? 'rotate-180' : ''}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 12 15 18 9"/>
            </svg>
        );

        const ChartLine = () => (
            <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 3v18h18M7 16l4-4 4 4 6-6"/>
            </svg>
        );
        
        const Newspaper = () => (
            <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/>
                <path d="M18 14h-8M15 18h-5M10 6h8v4h-8V6Z"/>
            </svg>
        );

        const Calculator = () => (
            <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="4" y="2" width="16" height="20" rx="2"/>
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="16" y1="10" x2="16" y2="10"/>
                <line x1="12" y1="10" x2="12" y2="10"/>
                <line x1="8" y1="10" x2="8" y2="10"/>
                <line x1="16" y1="14" x2="16" y2="14"/>
                <line x1="12" y1="14" x2="12" y2="14"/>
                <line x1="8" y1="14" x2="8" y2="14"/>
                <line x1="16" y1="18" x2="16" y2="18"/>
                <line x1="12" y1="18" x2="12" y2="18"/>
                <line x1="8" y1="18" x2="8" y2="18"/>
            </svg>
        );
        
        function App() {
            const BACKEND_URL = 'https://pl-tracker-api.onrender.com';
            
            const [activeTab, setActiveTab] = useState('standings');
            const [standings, setStandings] = useState([]);
            const [matches, setMatches] = useState([]);
            const [scorers, setScorers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [expandedTeam, setExpandedTeam] = useState(null);
            const [expandedMatch, setExpandedMatch] = useState(null);
            const [expandedScorer, setExpandedScorer] = useState(null);
            const [guardianArticles, setGuardianArticles] = useState({});
            const [loadingArticles, setLoadingArticles] = useState({});
            const [headToHeadStats, setHeadToHeadStats] = useState({});
            const [season, setSeason] = useState('');
            const [lastUpdate, setLastUpdate] = useState(null);
            const [sortBy, setSortBy] = useState('position');
            const [fixturesView, setFixturesView] = useState('this week');
            const [selectedSeason, setSelectedSeason] = useState('current');
            const [selectedTeam, setSelectedTeam] = useState('all');
            const [lastSeasonData, setLastSeasonData] = useState({ standings: [], matches: [] });
            const [scenarioType, setScenarioType] = useState('current_form');
            const [projectedStandings, setProjectedStandings] = useState([]);
            const [yoySelectedTeam, setYoySelectedTeam] = useState('');
            const [formTableGames, setFormTableGames] = useState(5);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            const yoyChartRef = useRef(null);
            const yoyChartInstance = useRef(null);

            async function loadData() {
                setLoading(true);
                setError(null);
                
                try {
                    const healthRes = await fetch(`${BACKEND_URL}/api/health`);
                    if (!healthRes.ok) throw new Error('Backend not responding');
                    
                    const [standingsRes, matchesRes, scorersRes] = await Promise.all([
                        fetch(`${BACKEND_URL}/api/standings`),
                        fetch(`${BACKEND_URL}/api/matches`),
                        fetch(`${BACKEND_URL}/api/scorers`)
                    ]);
                    
                    const standingsData = await standingsRes.json();
                    if (standingsData.standings?.[0]?.table) {
                        setStandings(standingsData.standings[0].table);
                        // Set first team as default for YoY comparison
                        if (standingsData.standings[0].table.length > 0 && !yoySelectedTeam) {
                            setYoySelectedTeam(standingsData.standings[0].table[0].team.id.toString());
                        }
                        if (standingsData.season) {
                            setSeason(`${standingsData.season.startDate.slice(0,4)}-${standingsData.season.endDate.slice(0,4)}`);
                        }
                    }
                    
                    const matchesData = await matchesRes.json();
                    if (matchesData.matches) {
                        setMatches(matchesData.matches);
                    }
                    
                    const scorersData = await scorersRes.json();
                    if (scorersData.scorers) {
                        setScorers(scorersData.scorers.slice(0, 20));
                    }
                    
                    // Load last season data
                    try {
                        const [lastStandingsRes, lastMatchesRes] = await Promise.all([
                            fetch(`${BACKEND_URL}/api/standings/last`),
                            fetch(`${BACKEND_URL}/api/matches/last`)
                        ]);
                        
                        const lastStandingsData = await lastStandingsRes.json();
                        const lastMatchesData = await lastMatchesRes.json();
                        
                        setLastSeasonData({
                            standings: lastStandingsData.standings?.[0]?.table || [],
                            matches: lastMatchesData.matches || []
                        });
                    } catch (err) {
                        console.warn('Could not load last season data:', err);
                    }
                    
                    setLastUpdate(new Date());
                } catch (err) {
                    setError(`Failed to load: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            }

            useEffect(() => {
                loadData();
                const interval = setInterval(loadData, 300000);
                return () => clearInterval(interval);
            }, []);

            // Cleanup chart on unmount or tab change
            useEffect(() => {
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                        chartInstance.current = null;
                    }
                    if (yoyChartInstance.current) {
                        yoyChartInstance.current.destroy();
                        yoyChartInstance.current = null;
                    }
                };
            }, [activeTab]);

            // Calculate scenarios when tab is active or scenario type changes
            useEffect(() => {
                if (activeTab === 'scenarios' && standings.length > 0 && matches.length > 0) {
                    calculateScenario(scenarioType);
                }
            }, [activeTab, scenarioType, standings, matches]);

            function formatDate(dateStr) {
                return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }

            function formatTime(dateStr) {
                return new Date(dateStr).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            }

            function getDayOfWeek(dateStr) {
                return new Date(dateStr).toLocaleDateString('en-US', { weekday: 'short' });
            }

            function getTeamMatches(teamId, limit = 10) {
                return matches.filter(m => 
                    m.status === 'FINISHED' && 
                    (m.homeTeam.id === teamId || m.awayTeam.id === teamId)
                )
                    .sort((a, b) => new Date(b.utcDate) - new Date(a.utcDate))
                    .slice(0, limit);
            }

            function getNextMatch(teamId) {
                return matches.find(m => 
                    (m.status === 'TIMED' || m.status === 'SCHEDULED') && 
                    (m.homeTeam.id === teamId || m.awayTeam.id === teamId)
                );
            }

            function getFormGuide(teamId, limit = 5) {
                return getTeamMatches(teamId, limit).reverse().map(m => {
                    const isHome = m.homeTeam.id === teamId;
                    const teamScore = isHome ? m.score.fullTime.home : m.score.fullTime.away;
                    const oppScore = isHome ? m.score.fullTime.away : m.score.fullTime.home;
                    return teamScore > oppScore ? 'W' : teamScore < oppScore ? 'L' : 'D';
                });
            }

            function getFormStreak(teamId) {
                const form = getFormGuide(teamId, 10);
                if (form.length === 0) return null;
                
                let streak = 1;
                const current = form[form.length - 1];
                
                for (let i = form.length - 2; i >= 0; i--) {
                    if (form[i] === current) streak++;
                    else break;
                }
                
                if (current === 'W') return `${streak} win${streak > 1 ? 's' : ''} in a row`;
                if (current === 'L') return `${streak} loss${streak > 1 ? 'es' : ''} in a row`;
                return `${streak} draw${streak > 1 ? 's' : ''} in a row`;
            }

            function getHomeAwayRecord(teamId) {
                const homeMatches = matches.filter(m => m.status === 'FINISHED' && m.homeTeam.id === teamId);
                const awayMatches = matches.filter(m => m.status === 'FINISHED' && m.awayTeam.id === teamId);
                
                const calcRecord = (matches, isHome) => {
                    let w = 0, d = 0, l = 0;
                    matches.forEach(m => {
                        const score = isHome ? m.score.fullTime.home : m.score.fullTime.away;
                        const opp = isHome ? m.score.fullTime.away : m.score.fullTime.home;
                        if (score > opp) w++;
                        else if (score < opp) l++;
                        else d++;
                    });
                    return { w, d, l, played: matches.length };
                };
                
                return {
                    home: calcRecord(homeMatches, true),
                    away: calcRecord(awayMatches, false)
                };
            }

            function getSortedStandings() {
                const sorted = [...standings];
                if (sortBy === 'form') {
                    return sorted.sort((a, b) => {
                        const aWins = getFormGuide(a.team.id).filter(r => r === 'W').length;
                        const bWins = getFormGuide(b.team.id).filter(r => r === 'W').length;
                        return bWins - aWins;
                    });
                }
                if (sortBy === 'goals') {
                    return sorted.sort((a, b) => b.goalsFor - a.goalsFor);
                }
                if (sortBy === 'defense') {
                    return sorted.sort((a, b) => a.goalsAgainst - b.goalsAgainst);
                }
                return sorted.sort((a, b) => a.position - b.position);
            }

            // Scenario Planning Functions
            function getRemainingMatches(teamId) {
                return matches.filter(m => 
                    (m.status === 'TIMED' || m.status === 'SCHEDULED') &&
                    (m.homeTeam.id === teamId || m.awayTeam.id === teamId)
                );
            }

            function calculateScenario(scenario) {
                const projected = standings.map(team => {
                    const remainingMatches = getRemainingMatches(team.team.id);
                    const currentPoints = team.points;
                    let projectedPoints = currentPoints;
                    let projectedGF = team.goalsFor;
                    let projectedGA = team.goalsAgainst;

                    const ppg = team.playedGames > 0 ? team.points / team.playedGames : 0;
                    const recentForm = getFormGuide(team.team.id, 5);
                    const recentPPG = recentForm.length > 0 
                        ? recentForm.reduce((sum, r) => sum + (r === 'W' ? 3 : r === 'D' ? 1 : 0), 0) / recentForm.length
                        : ppg;

                    const homeAwayRecord = getHomeAwayRecord(team.team.id);
                    const homePPG = homeAwayRecord.home.played > 0
                        ? (homeAwayRecord.home.w * 3 + homeAwayRecord.home.d) / homeAwayRecord.home.played
                        : ppg;
                    const awayPPG = homeAwayRecord.away.played > 0
                        ? (homeAwayRecord.away.w * 3 + homeAwayRecord.away.d) / homeAwayRecord.away.played
                        : ppg;

                    remainingMatches.forEach(match => {
                        const isHome = match.homeTeam.id === team.team.id;
                        let points = 0;
                        let goalsFor = 0;
                        let goalsAgainst = 0;

                        switch (scenario) {
                            case 'current_form':
                                points = ppg;
                                goalsFor = team.playedGames > 0 ? team.goalsFor / team.playedGames : 1.5;
                                goalsAgainst = team.playedGames > 0 ? team.goalsAgainst / team.playedGames : 1.5;
                                break;
                            
                            case 'recent_form':
                                points = recentPPG;
                                goalsFor = team.playedGames > 0 ? team.goalsFor / team.playedGames : 1.5;
                                goalsAgainst = team.playedGames > 0 ? team.goalsAgainst / team.playedGames : 1.5;
                                break;
                            
                            case 'home_away_form':
                                points = isHome ? homePPG : awayPPG;
                                if (isHome) {
                                    goalsFor = homeAwayRecord.home.played > 0 
                                        ? matches.filter(m => m.status === 'FINISHED' && m.homeTeam.id === team.team.id)
                                            .reduce((sum, m) => sum + m.score.fullTime.home, 0) / homeAwayRecord.home.played
                                        : 1.5;
                                    goalsAgainst = homeAwayRecord.home.played > 0
                                        ? matches.filter(m => m.status === 'FINISHED' && m.homeTeam.id === team.team.id)
                                            .reduce((sum, m) => sum + m.score.fullTime.away, 0) / homeAwayRecord.home.played
                                        : 1.5;
                                } else {
                                    goalsFor = homeAwayRecord.away.played > 0
                                        ? matches.filter(m => m.status === 'FINISHED' && m.awayTeam.id === team.team.id)
                                            .reduce((sum, m) => sum + m.score.fullTime.away, 0) / homeAwayRecord.away.played
                                        : 1.5;
                                    goalsAgainst = homeAwayRecord.away.played > 0
                                        ? matches.filter(m => m.status === 'FINISHED' && m.awayTeam.id === team.team.id)
                                            .reduce((sum, m) => sum + m.score.fullTime.home, 0) / homeAwayRecord.away.played
                                        : 1.5;
                                }
                                break;
                        }

                        projectedPoints += points;
                        projectedGF += goalsFor;
                        projectedGA += goalsAgainst;
                    });

                    return {
                        ...team,
                        projectedPoints: Math.round(projectedPoints),
                        projectedGF: Math.round(projectedGF),
                        projectedGA: Math.round(projectedGA),
                        projectedGD: Math.round(projectedGF - projectedGA),
                        remainingGames: remainingMatches.length,
                        pointsGain: Math.round(projectedPoints - currentPoints)
                    };
                });

                // Sort by projected points, then by GD
                projected.sort((a, b) => {
                    if (b.projectedPoints !== a.projectedPoints) {
                        return b.projectedPoints - a.projectedPoints;
                    }
                    return b.projectedGD - a.projectedGD;
                });

                // Add projected position
                projected.forEach((team, idx) => {
                    team.projectedPosition = idx + 1;
                    team.positionChange = team.position - team.projectedPosition;
                });

                setProjectedStandings(projected);
            }

            // Calculate accumulated points per matchday for visualization
            function calculatePointsProgression(standingsData, matchesData) {
                const progression = {};
                
                standingsData.forEach(team => {
                    progression[team.team.id] = {
                        name: team.team.shortName,
                        crest: team.team.crest,
                        data: [0] // Start with 0 points
                    };
                });

                // Get all finished matches sorted by matchday
                const finishedMatches = matchesData
                    .filter(m => m.status === 'FINISHED' && m.matchday)
                    .sort((a, b) => a.matchday - b.matchday);

                const maxMatchday = Math.max(...finishedMatches.map(m => m.matchday));

                for (let md = 1; md <= maxMatchday; md++) {
                    const mdMatches = finishedMatches.filter(m => m.matchday === md);
                    
                    standingsData.forEach(team => {
                        const lastPoints = progression[team.team.id].data[progression[team.team.id].data.length - 1];
                        const match = mdMatches.find(m => 
                            m.homeTeam.id === team.team.id || m.awayTeam.id === team.team.id
                        );

                        if (match) {
                            const isHome = match.homeTeam.id === team.team.id;
                            const teamScore = isHome ? match.score.fullTime.home : match.score.fullTime.away;
                            const oppScore = isHome ? match.score.fullTime.away : match.score.fullTime.home;
                            const points = teamScore > oppScore ? 3 : teamScore === oppScore ? 1 : 0;
                            progression[team.team.id].data.push(lastPoints + points);
                        } else {
                            progression[team.team.id].data.push(lastPoints);
                        }
                    });
                }

                return { progression, maxMatchday };
            }

            // Calculate single team's points progression for YoY comparison
            function calculateTeamProgression(teamId, standingsData, matchesData) {
                // Find team in standings to get team name
                const teamStanding = standingsData.find(t => t.team.id === parseInt(teamId));
                if (!teamStanding) return null;

                const progression = [0]; // Start with 0 points

                // Get all finished matches for this team sorted by matchday
                const finishedMatches = matchesData
                    .filter(m => m.status === 'FINISHED' && m.matchday && 
                                (m.homeTeam.id === parseInt(teamId) || m.awayTeam.id === parseInt(teamId)))
                    .sort((a, b) => a.matchday - b.matchday);

                if (finishedMatches.length === 0) return null;

                const maxMatchday = Math.max(...finishedMatches.map(m => m.matchday));

                for (let md = 1; md <= maxMatchday; md++) {
                    const match = finishedMatches.find(m => m.matchday === md);
                    const lastPoints = progression[progression.length - 1];

                    if (match) {
                        const isHome = match.homeTeam.id === parseInt(teamId);
                        const teamScore = isHome ? match.score.fullTime.home : match.score.fullTime.away;
                        const oppScore = isHome ? match.score.fullTime.away : match.score.fullTime.home;
                        const points = teamScore > oppScore ? 3 : teamScore === oppScore ? 1 : 0;
                        progression.push(lastPoints + points);
                    } else {
                        progression.push(lastPoints);
                    }
                }

                return {
                    name: teamStanding.team.shortName,
                    data: progression,
                    maxMatchday: maxMatchday
                };
            }
            
            async function fetchGuardianArticle(homeTeam, awayTeam, type, matchId) {
                const cacheKey = `${matchId}-${type}`;

                // Check if already loaded
                if (guardianArticles[cacheKey]) {
                    return;
                }

                setLoadingArticles(prev => ({ ...prev, [cacheKey]: true }));

                try {
                    const response = await fetch(
                        `${BACKEND_URL}/api/guardian/match?homeTeam=${encodeURIComponent(homeTeam)}&awayTeam=${encodeURIComponent(awayTeam)}&type=${type}`
                    );
                    const data = await response.json();

                    if (data.success && data.articles.length > 0) {
                        setGuardianArticles(prev => ({
                            ...prev,
                            [cacheKey]: {
                                ...data.articles[0],
                                searchStrategy: data.searchStrategy
                            }
                        }));
                    } else {
                        setGuardianArticles(prev => ({
                            ...prev,
                            [cacheKey]: {
                                noResults: true,
                                message: data.message || `No ${type} available for this match`
                            }
                        }));
                    }
                } catch (error) {
                    console.error('Error fetching Guardian article:', error);
                    setGuardianArticles(prev => ({
                        ...prev,
                        [cacheKey]: {
                            error: true,
                            message: 'Error loading article. Please try again.'
                        }
                    }));
                } finally {
                    setLoadingArticles(prev => ({ ...prev, [cacheKey]: false }));
                }
            }

            async function fetchHeadToHead(matchId) {
                // Check if already loaded
                if (headToHeadStats[matchId]) {
                    return;
                }

                try {
                    const response = await fetch(`${BACKEND_URL}/api/head2head/${matchId}?limit=10`);
                    const data = await response.json();

                    if (data.success && data.stats) {
                        setHeadToHeadStats(prev => ({
                            ...prev,
                            [matchId]: data.stats
                        }));
                    } else {
                        setHeadToHeadStats(prev => ({
                            ...prev,
                            [matchId]: null
                        }));
                    }
                } catch (error) {
                    console.error('Error fetching head-to-head:', error);
                    setHeadToHeadStats(prev => ({
                        ...prev,
                        [matchId]: null
                    }));
                }
            }

            function toggleMatchExpansion(matchId, homeTeam, awayTeam, status) {
                if (expandedMatch === matchId) {
                    setExpandedMatch(null);
                } else {
                    setExpandedMatch(matchId);
                    const type = status === 'FINISHED' ? 'report' : 'preview';
                    fetchGuardianArticle(homeTeam, awayTeam, type, matchId);
                    // Also fetch head-to-head stats for preview context
                    if (status !== 'FINISHED') {
                        fetchHeadToHead(matchId);
                    }
                }
            }
            
            function stripHtml(html) {
                if (!html) return '';
                return html.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
            }
            
            function truncateText(text, maxLength = 200) {
                if (!text || text.length <= maxLength) return text;
                return text.substring(0, maxLength) + '...';
            }

            // Render points progression chart
            useEffect(() => {
                if (activeTab === 'visualization' && chartRef.current) {
                    const currentStandings = selectedSeason === 'current' ? standings : lastSeasonData.standings;
                    const currentMatches = selectedSeason === 'current' ? matches : lastSeasonData.matches;
                    
                    if (currentStandings.length === 0 || currentMatches.length === 0) return;
                    
                    const { progression, maxMatchday } = calculatePointsProgression(currentStandings, currentMatches);
                    
                    // Destroy existing chart
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    const colors = [
                        '#10b981', '#3b82f6', '#ef4444', '#f59e0b', '#8b5cf6',
                        '#ec4899', '#06b6d4', '#84cc16', '#f97316', '#14b8a6',
                        '#6366f1', '#a855f7', '#eab308', '#22c55e', '#0ea5e9',
                        '#f43f5e', '#d946ef', '#facc15', '#4ade80', '#38bdf8'
                    ];

                    const datasets = Object.entries(progression).map(([teamId, team], idx) => {
                        const isSelected = selectedTeam === 'all' || selectedTeam === teamId;
                        return {
                            label: team.name,
                            data: team.data,
                            borderColor: colors[idx % colors.length],
                            backgroundColor: colors[idx % colors.length] + '20',
                            borderWidth: isSelected ? 3 : 1,
                            tension: 0.1,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            hidden: selectedTeam !== 'all' && selectedTeam !== teamId
                        };
                    });

                    const ctx = chartRef.current.getContext('2d');
                    chartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({ length: maxMatchday + 1 }, (_, i) => i),
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: selectedTeam === 'all',
                                    position: 'right',
                                    labels: {
                                        color: '#fff',
                                        font: { size: 10 },
                                        boxWidth: 12,
                                        padding: 8,
                                        usePointStyle: true
                                    }
                                },
                                title: {
                                    display: true,
                                    text: `Points Progression - ${selectedSeason === 'current' ? 'Current Season' : 'Last Season'}`,
                                    color: '#fff',
                                    font: { size: 16, weight: 'bold' }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Matchday',
                                        color: '#fff'
                                    },
                                    ticks: { color: '#fff' },
                                    grid: { color: '#ffffff20' }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Points',
                                        color: '#fff'
                                    },
                                    ticks: { color: '#fff' },
                                    grid: { color: '#ffffff20' }
                                }
                            },
                            interaction: {
                                mode: 'nearest',
                                axis: 'x',
                                intersect: false
                            }
                        }
                    });
                }
            }, [activeTab, standings, matches, selectedSeason, selectedTeam, lastSeasonData]);

            // Render year-over-year comparison chart
            useEffect(() => {
                if (activeTab === 'visualization' && yoyChartRef.current && yoySelectedTeam) {
                    // Check if we have data for both seasons
                    if (standings.length === 0 || matches.length === 0 || 
                        lastSeasonData.standings.length === 0 || lastSeasonData.matches.length === 0) {
                        return;
                    }

                    // Calculate progression for current season
                    const currentProgression = calculateTeamProgression(yoySelectedTeam, standings, matches);
                    
                    // Calculate progression for last season
                    const lastProgression = calculateTeamProgression(yoySelectedTeam, lastSeasonData.standings, lastSeasonData.matches);

                    if (!currentProgression && !lastProgression) return;

                    // Destroy existing chart
                    if (yoyChartInstance.current) {
                        yoyChartInstance.current.destroy();
                    }

                    const maxMatchday = Math.max(
                        currentProgression?.maxMatchday || 0,
                        lastProgression?.maxMatchday || 0
                    );

                    const datasets = [];

                    if (lastProgression) {
                        datasets.push({
                            label: `Last Season (${lastProgression.name})`,
                            data: lastProgression.data,
                            borderColor: '#94a3b8',
                            backgroundColor: '#94a3b820',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            tension: 0.1,
                            pointRadius: 3,
                            pointHoverRadius: 6,
                        });
                    }

                    if (currentProgression) {
                        datasets.push({
                            label: `This Season (${currentProgression.name})`,
                            data: currentProgression.data,
                            borderColor: '#8b5cf6',
                            backgroundColor: '#8b5cf620',
                            borderWidth: 4,
                            tension: 0.1,
                            pointRadius: 4,
                            pointHoverRadius: 7,
                        });
                    }

                    const ctx = yoyChartRef.current.getContext('2d');
                    yoyChartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({ length: maxMatchday + 1 }, (_, i) => i),
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        color: '#fff',
                                        font: { size: 12 },
                                        boxWidth: 15,
                                        padding: 15,
                                        usePointStyle: true
                                    }
                                },
                                title: {
                                    display: true,
                                    text: `Year over Year Comparison - ${currentProgression?.name || lastProgression?.name}`,
                                    color: '#fff',
                                    font: { size: 16, weight: 'bold' }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    callbacks: {
                                        title: function(context) {
                                            return `Matchday ${context[0].label}`;
                                        },
                                        label: function(context) {
                                            return `${context.dataset.label}: ${context.parsed.y} points`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Matchday',
                                        color: '#fff'
                                    },
                                    ticks: { color: '#fff' },
                                    grid: { color: '#ffffff20' }
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Points',
                                        color: '#fff'
                                    },
                                    ticks: { color: '#fff' },
                                    grid: { color: '#ffffff20' },
                                    beginAtZero: true
                                }
                            },
                            interaction: {
                                mode: 'nearest',
                                axis: 'x',
                                intersect: false
                            }
                        }
                    });
                }
            }, [activeTab, yoySelectedTeam, standings, matches, lastSeasonData]);

            // Get matches by week
            function getMatchesByWeek(view) {
                const now = new Date();
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay()); // Sunday
                startOfWeek.setHours(0, 0, 0, 0);

                let weekStart, weekEnd;

                if (view === 'this week') {
                    weekStart = startOfWeek;
                    weekEnd = new Date(startOfWeek);
                    weekEnd.setDate(weekEnd.getDate() + 7);
                } else if (view === 'last week') {
                    weekStart = new Date(startOfWeek);
                    weekStart.setDate(weekStart.getDate() - 7);
                    weekEnd = new Date(startOfWeek);
                } else { // next week
                    weekStart = new Date(startOfWeek);
                    weekStart.setDate(weekStart.getDate() + 7);
                    weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekEnd.getDate() + 7);
                }

                return matches.filter(m => {
                    const matchDate = new Date(m.utcDate);
                    return matchDate >= weekStart && matchDate < weekEnd;
                });
            }

            function groupMatchesByDay(matchList) {
                const grouped = {};
                matchList.forEach(m => {
                    const date = new Date(m.utcDate).toDateString();
                    if (!grouped[date]) grouped[date] = [];
                    grouped[date].push(m);
                });
                return grouped;
            }


            // Calculate form-based standings
            function calculateFormTable(numGames) {
                return standings.map(team => {
                    const recentMatches = getTeamMatches(team.team.id, numGames);
                    
                    let points = 0;
                    let wins = 0;
                    let draws = 0;
                    let losses = 0;
                    let goalsFor = 0;
                    let goalsAgainst = 0;
                    
                    recentMatches.forEach(m => {
                        const isHome = m.homeTeam.id === team.team.id;
                        const teamScore = isHome ? m.score.fullTime.home : m.score.fullTime.away;
                        const oppScore = isHome ? m.score.fullTime.away : m.score.fullTime.home;
                        
                        goalsFor += teamScore;
                        goalsAgainst += oppScore;
                        
                        if (teamScore > oppScore) {
                            wins++;
                            points += 3;
                        } else if (teamScore === oppScore) {
                            draws++;
                            points += 1;
                        } else {
                            losses++;
                        }
                    });
                    
                    return {
                        ...team,
                        formPoints: points,
                        formWins: wins,
                        formDraws: draws,
                        formLosses: losses,
                        formGF: goalsFor,
                        formGA: goalsAgainst,
                        formGD: goalsFor - goalsAgainst,
                        formPlayed: recentMatches.length,
                        formPPG: recentMatches.length > 0 ? (points / recentMatches.length).toFixed(2) : '0.00'
                    };
                }).sort((a, b) => {
                    // Sort by form points, then GD, then GF
                    if (b.formPoints !== a.formPoints) return b.formPoints - a.formPoints;
                    if (b.formGD !== a.formGD) return b.formGD - a.formGD;
                    return b.formGF - a.formGF;
                }).map((team, idx) => ({
                    ...team,
                    formPosition: idx + 1,
                    positionChange: team.position - (idx + 1)
                }));
            }

            // Generate results matrix
            function generateResultsMatrix() {
                const matrix = {};
                
                standings.forEach(team => {
                    matrix[team.team.id] = {};
                });
                
                matches.filter(m => m.status === 'FINISHED').forEach(match => {
                    const homeId = match.homeTeam.id;
                    const awayId = match.awayTeam.id;
                    const homeScore = match.score.fullTime.home;
                    const awayScore = match.score.fullTime.away;
                    
                    // Store result from home team's perspective
                    if (matrix[homeId]) {
                        matrix[homeId][awayId] = {
                            score: `${homeScore}-${awayScore}`,
                            result: homeScore > awayScore ? 'W' : homeScore < awayScore ? 'L' : 'D',
                            home: true
                        };
                    }
                    
                    // Store result from away team's perspective
                    if (matrix[awayId]) {
                        matrix[awayId][homeId] = {
                            score: `${awayScore}-${homeScore}`,
                            result: awayScore > homeScore ? 'W' : awayScore < homeScore ? 'L' : 'D',
                            home: false
                        };
                    }
                });
                
                return matrix;
            }

            function getScorerMatches(playerId) {
                const scorer = scorers.find(s => s.player.id === playerId);
                if (!scorer) return [];
                
                return matches.filter(m => 
                    m.status === 'FINISHED' &&
                    (m.homeTeam.id === scorer.team.id || m.awayTeam.id === scorer.team.id)
                ).slice(0, 10);
            }

            // Calculate form-based standings
            function calculateFormTable(numGames) {
                return standings.map(team => {
                    const recentMatches = getTeamMatches(team.team.id, numGames);
                    
                    let points = 0;
                    let wins = 0;
                    let draws = 0;
                    let losses = 0;
                    let goalsFor = 0;
                    let goalsAgainst = 0;
                    
                    recentMatches.forEach(m => {
                        const isHome = m.homeTeam.id === team.team.id;
                        const teamScore = isHome ? m.score.fullTime.home : m.score.fullTime.away;
                        const oppScore = isHome ? m.score.fullTime.away : m.score.fullTime.home;
                        
                        goalsFor += teamScore;
                        goalsAgainst += oppScore;
                        
                        if (teamScore > oppScore) {
                            wins++;
                            points += 3;
                        } else if (teamScore === oppScore) {
                            draws++;
                            points += 1;
                        } else {
                            losses++;
                        }
                    });
                    
                    return {
                        ...team,
                        formPoints: points,
                        formWins: wins,
                        formDraws: draws,
                        formLosses: losses,
                        formGF: goalsFor,
                        formGA: goalsAgainst,
                        formGD: goalsFor - goalsAgainst,
                        formPlayed: recentMatches.length,
                        formPPG: recentMatches.length > 0 ? (points / recentMatches.length).toFixed(2) : '0.00'
                    };
                }).sort((a, b) => {
                    // Sort by form points, then GD, then GF
                    if (b.formPoints !== a.formPoints) return b.formPoints - a.formPoints;
                    if (b.formGD !== a.formGD) return b.formGD - a.formGD;
                    return b.formGF - a.formGF;
                }).map((team, idx) => ({
                    ...team,
                    formPosition: idx + 1,
                    positionChange: team.position - (idx + 1)
                }));
            }

            // Generate results matrix
            function generateResultsMatrix() {
                const matrix = {};
                
                standings.forEach(team => {
                    matrix[team.team.id] = {};
                });
                
                matches.filter(m => m.status === 'FINISHED').forEach(match => {
                    const homeId = match.homeTeam.id;
                    const awayId = match.awayTeam.id;
                    const homeScore = match.score.fullTime.home;
                    const awayScore = match.score.fullTime.away;
                    
                    // Store result from home team's perspective
                    if (matrix[homeId]) {
                        matrix[homeId][awayId] = {
                            score: `${homeScore}-${awayScore}`,
                            result: homeScore > awayScore ? 'W' : homeScore < awayScore ? 'L' : 'D',
                            home: true
                        };
                    }
                    
                    // Store result from away team's perspective
                    if (matrix[awayId]) {
                        matrix[awayId][homeId] = {
                            score: `${awayScore}-${homeScore}`,
                            result: awayScore > homeScore ? 'W' : awayScore < homeScore ? 'L' : 'D',
                            home: false
                        };
                    }
                });
                
                return matrix;
            }

            const weekMatches = getMatchesByWeek(fixturesView);
            const groupedByDay = groupMatchesByDay(weekMatches);

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900">
                    {/* Header */}
                    <div className="bg-purple-950 text-white p-3 shadow-lg sticky top-0 z-10">
                        <div className="flex justify-between items-center max-w-7xl mx-auto">
                            <div className="flex items-center gap-2">
                                <Trophy />
                                <h1 className="text-lg font-bold">Premier League {season}</h1>
                            </div>
                            <button
                                onClick={loadData}
                                disabled={loading}
                                className="flex items-center gap-2 bg-purple-700 hover:bg-purple-600 px-3 py-2 rounded-lg disabled:opacity-50"
                            >
                                <RefreshCw spinning={loading} />
                                <span className="text-sm">Refresh</span>
                            </button>
                        </div>
                        {lastUpdate && (
                            <div className="text-xs text-purple-300 text-center mt-2">
                                Updated: {lastUpdate.toLocaleTimeString()}
                            </div>
                        )}
                    </div>

                    {/* Tabs */}
                    <div className="bg-purple-900 border-b border-purple-700">
                        <div className="max-w-7xl mx-auto flex overflow-x-auto">
                            {['standings', 'fixtures', 'scorers', 'form table', 'results matrix', 'visualization', 'scenarios'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`flex-1 py-2 px-4 text-sm font-medium whitespace-nowrap ${
                                        activeTab === tab ? 'bg-purple-800 text-white border-b-2 border-white' : 'text-purple-200 hover:bg-purple-800'
                                    }`}
                                >
                                    <span className="capitalize">{tab}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content */}
                    <div className="max-w-7xl mx-auto p-3">
                        {error && (
                            <div className="bg-red-500/20 border border-red-500/50 rounded-lg p-4 mb-4 text-white">
                                <div className="font-semibold mb-2"> Error</div>
                                <div className="text-sm">{error}</div>
                                <button onClick={loadData} className="mt-3 bg-red-600 px-4 py-2 rounded text-sm">
                                    Try Again
                                </button>
                            </div>
                        )}

                        {loading && !standings.length ? (
                            <div className="text-white text-center py-12">
                                <RefreshCw spinning={true} />
                                <div className="mt-2">Loading data...</div>
                            </div>
                        ) : (
                            <>
                                {/* STANDINGS */}
                                {activeTab === 'standings' && (
                                    <div>
                                        <div className="mb-4 flex gap-2 flex-wrap">
                                            <button
                                                onClick={() => setSortBy('position')}
                                                className={`px-3 py-1 rounded text-sm ${sortBy === 'position' ? 'bg-purple-700 text-white' : 'bg-white/10 text-white'}`}
                                            >
                                                Position
                                            </button>
                                            <button
                                                onClick={() => setSortBy('form')}
                                                className={`px-3 py-1 rounded text-sm ${sortBy === 'form' ? 'bg-purple-700 text-white' : 'bg-white/10 text-white'}`}
                                            >
                                                Form
                                            </button>
                                            <button
                                                onClick={() => setSortBy('goals')}
                                                className={`px-3 py-1 rounded text-sm ${sortBy === 'goals' ? 'bg-purple-700 text-white' : 'bg-white/10 text-white'}`}
                                            >
                                                Goals Scored
                                            </button>
                                            <button
                                                onClick={() => setSortBy('defense')}
                                                className={`px-3 py-1 rounded text-sm ${sortBy === 'defense' ? 'bg-purple-700 text-white' : 'bg-white/10 text-white'}`}
                                            >
                                                Best Defense
                                            </button>
                                        </div>

                                        <div className="bg-white/10 rounded-lg overflow-hidden">
                                            <div className="bg-purple-900/50 text-white text-xs font-semibold border-b border-purple-700">
                                                <div className="grid grid-cols-12 gap-2 px-3 py-2">
                                                    <div className="col-span-1 text-center">#</div>
                                                    <div className="col-span-4">Team</div>
                                                    <div className="col-span-2 text-center">Form</div>
                                                    <div className="col-span-1 text-center">P</div>
                                                    <div className="col-span-1 text-center">GF</div>
                                                    <div className="col-span-1 text-center">GA</div>
                                                    <div className="col-span-1 text-center">GD</div>
                                                    <div className="col-span-1 text-center">Pts</div>
                                                </div>
                                            </div>
                                            {getSortedStandings().map((team, idx) => {
                                                const isExpanded = expandedTeam === team.team.id;
                                                const form = getFormGuide(team.team.id);
                                                const streak = getFormStreak(team.team.id);
                                                const homeAway = getHomeAwayRecord(team.team.id);
                                                const ppg = team.playedGames > 0 ? (team.points / team.playedGames).toFixed(2) : '0.00';
                                                const recentMatches = getTeamMatches(team.team.id, 5);
                                                const nextMatch = getNextMatch(team.team.id);
                                                
                                                return (
                                                    <div key={idx}>
                                                        <div 
                                                            onClick={() => setExpandedTeam(isExpanded ? null : team.team.id)}
                                                            className="grid grid-cols-12 gap-2 px-3 py-2 text-white text-sm border-b border-purple-800/30 items-center hover:bg-white/10 cursor-pointer"
                                                        >
                                                            <div className={`col-span-1 text-center font-bold ${
                                                                team.position <= 4 ? 'text-green-400' : 
                                                                team.position === 5 ? 'text-blue-400' :
                                                                team.position >= 18 ? 'text-red-400' : 'text-purple-300'
                                                            }`}>
                                                                {sortBy === 'position' ? team.position : idx + 1}
                                                            </div>
                                                            <div className="col-span-4 flex items-center gap-2">
                                                                {team.team.crest && <img src={team.team.crest} alt="" className="w-5 h-5 object-contain" />}
                                                                <div className="flex-1">
                                                                    <div className="text-xs font-semibold truncate">{team.team.shortName}</div>
                                                                    <div className="text-xs text-purple-300">{ppg} PPG</div>
                                                                </div>
                                                                <ChevronDown isOpen={isExpanded} />
                                                            </div>
                                                            <div className="col-span-2 flex gap-0.5 justify-center">
                                                                {form.map((r, i) => (
                                                                    <div key={i} className={`form-box ${r === 'W' ? 'bg-green-500' : r === 'D' ? 'bg-yellow-500' : 'bg-red-500'}`}>
                                                                        {r}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                            <div className="col-span-1 text-center text-xs">{team.playedGames}</div>
                                                            <div className="col-span-1 text-center text-xs text-green-400">{team.goalsFor}</div>
                                                            <div className="col-span-1 text-center text-xs text-red-400">{team.goalsAgainst}</div>
                                                            <div className="col-span-1 text-center text-xs">{team.goalDifference > 0 ? '+' : ''}{team.goalDifference}</div>
                                                            <div className="col-span-1 text-center font-bold text-xs">{team.points}</div>
                                                        </div>
                                                        {isExpanded && (
                                                            <div className="bg-purple-900/30 px-3 py-4 border-b border-purple-800/30">
                                                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                                                    <div>
                                                                        <div className="text-xs text-purple-300 mb-2 font-semibold">Current Form</div>
                                                                        <div className="bg-white/5 rounded px-3 py-2">
                                                                            <div className="text-white font-semibold">{streak}</div>
                                                                            <div className="text-xs text-purple-200 mt-1">Last 5: {form.join('-')}</div>
                                                                        </div>
                                                                    </div>
                                                                    <div>
                                                                        <div className="text-xs text-purple-300 mb-2 font-semibold">Home Record</div>
                                                                        <div className="bg-white/5 rounded px-3 py-2">
                                                                            <div className="text-white font-semibold">
                                                                                {homeAway.home.w}W-{homeAway.home.d}D-{homeAway.home.l}L
                                                                            </div>
                                                                            <div className="text-xs text-purple-200 mt-1">{homeAway.home.played} played</div>
                                                                        </div>
                                                                    </div>
                                                                    <div>
                                                                        <div className="text-xs text-purple-300 mb-2 font-semibold">Away Record</div>
                                                                        <div className="bg-white/5 rounded px-3 py-2">
                                                                            <div className="text-white font-semibold">
                                                                                {homeAway.away.w}W-{homeAway.away.d}D-{homeAway.away.l}L
                                                                            </div>
                                                                            <div className="text-xs text-purple-200 mt-1">{homeAway.away.played} played</div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div className="mt-4">
                                                                    <div className="text-xs text-purple-300 mb-2 font-semibold">Last 5 Matches (Most Recent First)</div>
                                                                    <div className="space-y-1">
                                                                        {recentMatches.map((m, i) => {
                                                                            const isHome = m.homeTeam.id === team.team.id;
                                                                            const teamScore = isHome ? m.score.fullTime.home : m.score.fullTime.away;
                                                                            const oppScore = isHome ? m.score.fullTime.away : m.score.fullTime.home;
                                                                            const result = teamScore > oppScore ? 'W' : teamScore < oppScore ? 'L' : 'D';
                                                                            
                                                                            return (
                                                                                <div key={i} className="text-xs text-white bg-white/5 rounded px-2 py-1 flex justify-between">
                                                                                    <span className="text-purple-300">{formatDate(m.utcDate)}</span>
                                                                                    <span className="flex-1 text-center">
                                                                                        {m.homeTeam.shortName} <span className="font-bold">{m.score.fullTime.home}-{m.score.fullTime.away}</span> {m.awayTeam.shortName}
                                                                                    </span>
                                                                                    <span className={`font-bold ${result === 'W' ? 'text-green-400' : result === 'L' ? 'text-red-400' : 'text-yellow-400'}`}>
                                                                                        {result}
                                                                                    </span>
                                                                                </div>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                </div>

                                                                {nextMatch && (
                                                                    <div className="mt-4">
                                                                        <div className="text-xs text-purple-300 mb-2 font-semibold">Next Match</div>
                                                                        <div className="bg-white/5 rounded px-3 py-2">
                                                                            <div className="text-xs text-purple-200 mb-1">
                                                                                {formatDate(nextMatch.utcDate)}  {formatTime(nextMatch.utcDate)}
                                                                            </div>
                                                                            <div className="text-white font-semibold">
                                                                                {nextMatch.homeTeam.shortName} vs {nextMatch.awayTeam.shortName}
                                                                            </div>
                                                                            {nextMatch.matchday && (
                                                                                <div className="text-xs text-purple-200 mt-1">Matchday {nextMatch.matchday}</div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {/* FIXTURES */}
                                {activeTab === 'fixtures' && (
                                    <div>
                                        <div className="mb-4 flex gap-2">
                                            <button
                                                onClick={() => setFixturesView('last week')}
                                                className={`px-4 py-2 rounded text-sm font-medium ${fixturesView === 'last week' ? 'bg-purple-700 text-white' : 'bg-white/10 text-white hover:bg-white/20'}`}
                                            >
                                                Last Week
                                            </button>
                                            <button
                                                onClick={() => setFixturesView('this week')}
                                                className={`px-4 py-2 rounded text-sm font-medium ${fixturesView === 'this week' ? 'bg-purple-700 text-white' : 'bg-white/10 text-white hover:bg-white/20'}`}
                                            >
                                                This Week
                                            </button>
                                            <button
                                                onClick={() => setFixturesView('next week')}
                                                className={`px-4 py-2 rounded text-sm font-medium ${fixturesView === 'next week' ? 'bg-purple-700 text-white' : 'bg-white/10 text-white hover:bg-white/20'}`}
                                            >
                                                Next Week
                                            </button>
                                        </div>

                                        {Object.keys(groupedByDay).length > 0 ? (
                                            <div className="overflow-x-auto">
                                                <div className="flex gap-4 pb-4">
                                                    {Object.entries(groupedByDay).map(([date, dayMatches]) => (
                                                        <div key={date} className="day-column flex-shrink-0">
                                                            <div className="bg-purple-800 text-white text-center py-2 px-3 rounded-t-lg font-semibold">
                                                                <div className="text-sm">{getDayOfWeek(dayMatches[0].utcDate)}</div>
                                                                <div className="text-xs text-purple-200">{formatDate(dayMatches[0].utcDate)}</div>
                                                            </div>
                                                            <div className="space-y-2 mt-2">
                                                                {dayMatches.map((m, idx) => {
                                                                    const isExpanded = expandedMatch === m.id;
                                                                    const articleType = m.status === 'FINISHED' ? 'report' : 'preview';
                                                                    const cacheKey = `${m.id}-${articleType}`;
                                                                    const article = guardianArticles[cacheKey];
                                                                    const isLoadingArticle = loadingArticles[cacheKey];
                                                                    
                                                                    return (
                                                                        <div key={idx}>
                                                                            <div className="bg-white/10 rounded-lg p-3 text-white text-sm">
                                                                                <div className="text-xs text-purple-300 mb-2 text-center">
                                                                                    {formatTime(m.utcDate)}
                                                                                </div>
                                                                                <div className="space-y-2">
                                                                                    <div className="flex items-center gap-2">
                                                                                        <img src={m.homeTeam.crest} alt="" className="w-5 h-5" />
                                                                                        <span className="flex-1 text-xs">{m.homeTeam.shortName}</span>
                                                                                        {m.status === 'FINISHED' && (
                                                                                            <span className="font-bold text-yellow-400">{m.score.fullTime.home}</span>
                                                                                        )}
                                                                                    </div>
                                                                                    <div className="flex items-center gap-2">
                                                                                        <img src={m.awayTeam.crest} alt="" className="w-5 h-5" />
                                                                                        <span className="flex-1 text-xs">{m.awayTeam.shortName}</span>
                                                                                        {m.status === 'FINISHED' && (
                                                                                            <span className="font-bold text-yellow-400">{m.score.fullTime.away}</span>
                                                                                        )}
                                                                                    </div>
                                                                                </div>
                                                                                {m.status !== 'FINISHED' && m.status !== 'IN_PLAY' && (
                                                                                    <div className="text-xs text-center text-blue-300 mt-2">
                                                                                        Upcoming
                                                                                    </div>
                                                                                )}
                                                                                {m.status === 'IN_PLAY' && (
                                                                                    <div className="text-xs text-center text-green-400 mt-2 font-bold animate-pulse">
                                                                                        LIVE
                                                                                    </div>
                                                                                )}
                                                                                <button
                                                                                    onClick={() => toggleMatchExpansion(m.id, m.homeTeam.shortName, m.awayTeam.shortName, m.status)}
                                                                                    className="w-full mt-3 bg-purple-600/50 hover:bg-purple-600 px-3 py-1.5 rounded text-xs flex items-center justify-center gap-2 transition-colors"
                                                                                >
                                                                                    <Newspaper />
                                                                                    {m.status === 'FINISHED' ? 'Match Summary' : 'Match Preview'}
                                                                                </button>
                                                                            </div>
                                                                            
                                                                            {isExpanded && (
                                                                                <div className="bg-purple-900/50 rounded-b-lg p-3 mt-1 mb-2">
                                                                                    {isLoadingArticle ? (
                                                                                        <div className="text-center text-white text-xs py-4">
                                                                                            <RefreshCw spinning={true} />
                                                                                            <div className="mt-2">Loading {articleType}...</div>
                                                                                        </div>
                                                                                    ) : article ? (
                                                                                        article.noResults || article.error ? (
                                                                                            // Show head-to-head stats as fallback for previews
                                                                                            m.status !== 'FINISHED' && headToHeadStats[m.id] ? (
                                                                                                <div className="text-white text-xs">
                                                                                                    <div className="text-xs text-purple-300 mb-3">
                                                                                                         Head-to-Head Stats
                                                                                                    </div>
                                                                                                    <div className="bg-purple-800/50 rounded p-3 mb-3">
                                                                                                        <div className="grid grid-cols-3 gap-2 text-center mb-2">
                                                                                                            <div>
                                                                                                                <div className="font-bold text-green-400">{headToHeadStats[m.id].homeTeam.wins}</div>
                                                                                                                <div className="text-purple-200 text-xs">{headToHeadStats[m.id].homeTeam.name} Wins</div>
                                                                                                            </div>
                                                                                                            <div>
                                                                                                                <div className="font-bold text-yellow-400">{headToHeadStats[m.id].homeTeam.draws}</div>
                                                                                                                <div className="text-purple-200 text-xs">Draws</div>
                                                                                                            </div>
                                                                                                            <div>
                                                                                                                <div className="font-bold text-green-400">{headToHeadStats[m.id].awayTeam.wins}</div>
                                                                                                                <div className="text-purple-200 text-xs">{headToHeadStats[m.id].awayTeam.name} Wins</div>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                        <div className="text-center text-purple-200 text-xs">
                                                                                                            Last {headToHeadStats[m.id].totalMatches} meetings
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div className="space-y-2">
                                                                                                        <div className="font-semibold text-purple-300 mb-2">Recent Results:</div>
                                                                                                        {headToHeadStats[m.id].recentMatches.map((match, idx) => (
                                                                                                            <div key={idx} className="bg-purple-800/30 rounded p-2 flex justify-between items-center">
                                                                                                                <div className="flex-1">
                                                                                                                    <div className="text-xs">{match.homeTeam}</div>
                                                                                                                </div>
                                                                                                                <div className="font-bold px-3">
                                                                                                                    {match.homeScore} - {match.awayScore}
                                                                                                                </div>
                                                                                                                <div className="flex-1 text-right">
                                                                                                                    <div className="text-xs">{match.awayTeam}</div>
                                                                                                                </div>
                                                                                                            </div>
                                                                                                        ))}
                                                                                                    </div>
                                                                                                </div>
                                                                                            ) : (
                                                                                                <div className="text-center text-purple-300 text-xs py-3">
                                                                                                    {article.message}
                                                                                                </div>
                                                                                            )
                                                                                        ) : (
                                                                                            <div>
                                                                                                <div className="text-xs text-purple-300 mb-2">
                                                                                                    {m.status === 'FINISHED' ? ' Match Report' : ' Match Preview'} - The Guardian
                                                                                                </div>
                                                                                                <h4 className="font-semibold text-white text-sm mb-2">
                                                                                                    {article.fields?.headline || article.webTitle}
                                                                                                </h4>
                                                                                                {article.fields?.byline && (
                                                                                                    <div className="text-xs text-purple-200 mb-2">
                                                                                                        By {article.fields.byline}
                                                                                                    </div>
                                                                                                )}
                                                                                                {article.fields?.trailText && (
                                                                                                    <p className="text-xs text-white leading-relaxed mb-3 italic">
                                                                                                        {article.fields.trailText}
                                                                                                    </p>
                                                                                                )}
                                                                                                {article.fields?.body && (
                                                                                                    <p className="text-xs text-purple-100 leading-relaxed mb-3">
                                                                                                        {truncateText(stripHtml(article.fields.body), 300)}
                                                                                                    </p>
                                                                                                )}
                                                                                                <a
                                                                                                    href={article.webUrl}
                                                                                                    target="_blank"
                                                                                                    rel="noopener noreferrer"
                                                                                                    className="inline-block text-xs text-purple-300 hover:text-purple-100 underline"
                                                                                                >
                                                                                                    Read full article on The Guardian 
                                                                                                </a>
                                                                                            </div>
                                                                                        )
                                                                                    ) : null}
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="text-white text-center py-8 bg-white/10 rounded-lg">
                                                No matches scheduled for {fixturesView}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* SCORERS */}
                                {activeTab === 'scorers' && (
                                    <div>
                                        <h3 className="text-white font-semibold text-lg mb-4"> Top Scorers</h3>
                                        <div className="space-y-2">
                                            {scorers.map((s, i) => {
                                                const isExpanded = expandedScorer === s.player.id;
                                                const scorerMatches = getScorerMatches(s.player.id);
                                                
                                                return (
                                                    <div key={i}>
                                                        <div 
                                                            onClick={() => setExpandedScorer(isExpanded ? null : s.player.id)}
                                                            className="bg-white/10 rounded-lg p-3 text-white flex justify-between items-center cursor-pointer hover:bg-white/20 transition-colors"
                                                        >
                                                            <div className="flex items-center gap-3">
                                                                <div className="text-lg font-bold w-8">{i < 3 ? ['', '', ''][i] : i + 1}</div>
                                                                {s.team.crest && <img src={s.team.crest} alt="" className="w-8 h-8" />}
                                                                <div>
                                                                    <div className="font-semibold">{s.player.name}</div>
                                                                    <div className="text-xs text-purple-200">{s.team.shortName}  {s.player.nationality}</div>
                                                                </div>
                                                            </div>
                                                            <div className="flex items-center gap-3">
                                                                <div className="text-right">
                                                                    <div className="text-2xl font-bold text-yellow-400">{s.goals}</div>
                                                                    <div className="text-xs text-purple-200">
                                                                        {s.assists || 0} assists  {s.penalties || 0} pens
                                                                    </div>
                                                                </div>
                                                                <ChevronDown isOpen={isExpanded} />
                                                            </div>
                                                        </div>
                                                        
                                                        {isExpanded && (
                                                            <div className="bg-purple-900/30 px-4 py-3 rounded-b-lg mb-2">
                                                                <div className="text-xs text-purple-300 mb-2 font-semibold">
                                                                    Recent {s.team.shortName} Matches
                                                                </div>
                                                                <div className="text-xs text-purple-200 mb-3">
                                                                    Note: Individual goal data per match requires additional API access
                                                                </div>
                                                                <div className="space-y-1">
                                                                    {scorerMatches.map((m, idx) => {
                                                                        const isHome = m.homeTeam.id === s.team.id;
                                                                        const teamScore = isHome ? m.score.fullTime.home : m.score.fullTime.away;
                                                                        const oppScore = isHome ? m.score.fullTime.away : m.score.fullTime.home;
                                                                        
                                                                        return (
                                                                            <div key={idx} className="bg-white/5 rounded px-3 py-2 text-white">
                                                                                <div className="flex justify-between items-center">
                                                                                    <span className="text-purple-300">{formatDate(m.utcDate)}</span>
                                                                                    <span className="flex-1 text-center">
                                                                                        {m.homeTeam.shortName} <span className="font-bold text-yellow-400">{m.score.fullTime.home}-{m.score.fullTime.away}</span> {m.awayTeam.shortName}
                                                                                    </span>
                                                                                    <span className={`font-bold ${teamScore > oppScore ? 'text-green-400' : teamScore < oppScore ? 'text-red-400' : 'text-yellow-400'}`}>
                                                                                        {teamScore > oppScore ? 'W' : teamScore < oppScore ? 'L' : 'D'}
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        );
                                                                    })}
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}


                                {/* FORM TABLE */}
                                {activeTab === 'form table' && (
                                    <div>
                                        <div className="mb-6">
                                            <h3 className="text-white font-semibold text-xl mb-2 flex items-center gap-2">
                                                 Form Table
                                            </h3>
                                            <p className="text-purple-200 text-sm">
                                                Standings based only on recent form - see who's hot and who's not
                                            </p>
                                        </div>

                                        <div className="mb-4 flex gap-2">
                                            <button
                                                onClick={() => setFormTableGames(5)}
                                                className={`px-4 py-2 rounded text-sm font-medium ${formTableGames === 5 ? 'bg-purple-700 text-white' : 'bg-white/10 text-white hover:bg-white/20'}`}
                                            >
                                                Last 5 Games
                                            </button>
                                            <button
                                                onClick={() => setFormTableGames(10)}
                                                className={`px-4 py-2 rounded text-sm font-medium ${formTableGames === 10 ? 'bg-purple-700 text-white' : 'bg-white/10 text-white hover:bg-white/20'}`}
                                            >
                                                Last 10 Games
                                            </button>
                                            <button
                                                onClick={() => setFormTableGames(15)}
                                                className={`px-4 py-2 rounded text-sm font-medium ${formTableGames === 15 ? 'bg-purple-700 text-white' : 'bg-white/10 text-white hover:bg-white/20'}`}
                                            >
                                                Last 15 Games
                                            </button>
                                        </div>

                                        <div className="bg-white/10 rounded-lg overflow-hidden">
                                            <div className="bg-purple-900/50 text-white text-xs font-semibold border-b border-purple-700">
                                                <div className="grid grid-cols-12 gap-2 px-3 py-2">
                                                    <div className="col-span-1 text-center">#</div>
                                                    <div className="col-span-4">Team</div>
                                                    <div className="col-span-1 text-center">P</div>
                                                    <div className="col-span-1 text-center">W</div>
                                                    <div className="col-span-1 text-center">D</div>
                                                    <div className="col-span-1 text-center">L</div>
                                                    <div className="col-span-1 text-center">GF</div>
                                                    <div className="col-span-1 text-center">GA</div>
                                                    <div className="col-span-1 text-center">GD</div>
                                                    <div className="col-span-1 text-center">Pts</div>
                                                </div>
                                            </div>
                                            {calculateFormTable(formTableGames).map((team, idx) => {
                                                const form = getFormGuide(team.team.id, formTableGames);
                                                
                                                return (
                                                    <div 
                                                        key={idx}
                                                        className="grid grid-cols-12 gap-2 px-3 py-2 text-white text-sm border-b border-purple-800/30 items-center hover:bg-white/5"
                                                    >
                                                        <div className="col-span-1 text-center font-bold text-purple-300">
                                                            {team.formPosition}
                                                        </div>
                                                        <div className="col-span-4 flex items-center gap-2">
                                                            {team.team.crest && <img src={team.team.crest} alt="" className="w-5 h-5 object-contain" />}
                                                            <div className="flex-1">
                                                                <div className="text-xs font-semibold truncate">{team.team.shortName}</div>
                                                                <div className="text-xs flex items-center gap-1">
                                                                    <span className="text-purple-300">Actual: {team.position}</span>
                                                                    {team.positionChange !== 0 && (
                                                                        <span className={team.positionChange > 0 ? 'text-green-400' : 'text-red-400'}>
                                                                            ({team.positionChange > 0 ? '' : ''}{Math.abs(team.positionChange)})
                                                                        </span>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="col-span-1 text-center text-xs">{team.formPlayed}</div>
                                                        <div className="col-span-1 text-center text-xs text-green-400">{team.formWins}</div>
                                                        <div className="col-span-1 text-center text-xs text-yellow-400">{team.formDraws}</div>
                                                        <div className="col-span-1 text-center text-xs text-red-400">{team.formLosses}</div>
                                                        <div className="col-span-1 text-center text-xs">{team.formGF}</div>
                                                        <div className="col-span-1 text-center text-xs">{team.formGA}</div>
                                                        <div className="col-span-1 text-center text-xs">{team.formGD > 0 ? '+' : ''}{team.formGD}</div>
                                                        <div className="col-span-1 text-center font-bold text-xs text-yellow-400">{team.formPoints}</div>
                                                    </div>
                                                );
                                            })}
                                        </div>

                                        <div className="mt-4 bg-purple-800/30 rounded-lg p-4 text-white">
                                            <div className="text-sm font-semibold mb-2">Understanding the Form Table:</div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs">
                                                <div> Shows standings based <strong>only</strong> on recent matches</div>
                                                <div> Position change shows move from actual table position</div>
                                                <div> <span className="text-green-400"> Green</span> = Performing better than season average</div>
                                                <div> <span className="text-red-400"> Red</span> = Performing worse than season average</div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* RESULTS MATRIX */}
                                {activeTab === 'results matrix' && (
                                    <div>
                                        <div className="mb-6">
                                            <h3 className="text-white font-semibold text-xl mb-2 flex items-center gap-2">
                                                 Results Matrix
                                            </h3>
                                            <p className="text-purple-200 text-sm">
                                                Head-to-head results for all teams - see who beat who at a glance
                                            </p>
                                        </div>

                                        <div className="bg-white/10 rounded-lg overflow-x-auto">
                                            {(() => {
                                                const matrix = generateResultsMatrix();
                                                const sortedTeams = [...standings].sort((a, b) => a.position - b.position);
                                                
                                                return (
                                                    <table className="w-full text-xs text-white">
                                                        <thead>
                                                            <tr className="bg-purple-900/50 border-b border-purple-700">
                                                                <th className="sticky left-0 bg-purple-900/50 p-2 text-left font-semibold">Team</th>
                                                                {sortedTeams.map(team => (
                                                                    <th key={team.team.id} className="p-2 text-center font-semibold min-w-[60px]">
                                                                        <div className="flex flex-col items-center gap-1">
                                                                            <img src={team.team.crest} alt="" className="w-5 h-5 object-contain" />
                                                                            <span className="text-[9px]">{team.team.tla || team.team.shortName.slice(0, 3).toUpperCase()}</span>
                                                                        </div>
                                                                    </th>
                                                                ))}
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {sortedTeams.map(rowTeam => (
                                                                <tr key={rowTeam.team.id} className="border-b border-purple-800/30 hover:bg-white/5">
                                                                    <td className="sticky left-0 bg-purple-900/30 p-2 font-semibold">
                                                                        <div className="flex items-center gap-2">
                                                                            <img src={rowTeam.team.crest} alt="" className="w-5 h-5 object-contain" />
                                                                            <span className="truncate">{rowTeam.team.shortName}</span>
                                                                        </div>
                                                                    </td>
                                                                    {sortedTeams.map(colTeam => {
                                                                        if (rowTeam.team.id === colTeam.team.id) {
                                                                            return (
                                                                                <td key={colTeam.team.id} className="p-2 text-center bg-purple-900/20">
                                                                                    <div className="text-gray-500">-</div>
                                                                                </td>
                                                                            );
                                                                        }
                                                                        
                                                                        const result = matrix[rowTeam.team.id]?.[colTeam.team.id];
                                                                        
                                                                        if (!result) {
                                                                            return (
                                                                                <td key={colTeam.team.id} className="p-2 text-center">
                                                                                    <div className="text-gray-600 text-[10px]">TBD</div>
                                                                                </td>
                                                                            );
                                                                        }
                                                                        
                                                                        const bgColor = result.result === 'W' ? 'bg-green-500/20' : 
                                                                                       result.result === 'D' ? 'bg-yellow-500/20' : 
                                                                                       'bg-red-500/20';
                                                                        const borderColor = result.result === 'W' ? 'border-green-500/40' : 
                                                                                           result.result === 'D' ? 'border-yellow-500/40' : 
                                                                                           'border-red-500/40';
                                                                        
                                                                        return (
                                                                            <td key={colTeam.team.id} className="p-2">
                                                                                <div className={`${bgColor} ${borderColor} border rounded px-1 py-0.5 text-center`}>
                                                                                    <div className="font-bold text-[11px]">{result.score}</div>
                                                                                    <div className="text-[9px] text-gray-300">
                                                                                        {result.home ? 'H' : 'A'}
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        );
                                                                    })}
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                );
                                            })()}
                                        </div>

                                        <div className="mt-4 bg-purple-800/30 rounded-lg p-4 text-white">
                                            <div className="text-sm font-semibold mb-2">How to Read the Matrix:</div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs">
                                                <div> <span className="inline-block w-3 h-3 bg-green-500/40 border border-green-500/60 rounded mr-1"></span> Green = Win</div>
                                                <div> <span className="inline-block w-3 h-3 bg-yellow-500/40 border border-yellow-500/60 rounded mr-1"></span> Yellow = Draw</div>
                                                <div> <span className="inline-block w-3 h-3 bg-red-500/40 border border-red-500/60 rounded mr-1"></span> Red = Loss</div>
                                                <div> H = Home game, A = Away game</div>
                                                <div> Score shown is from row team's perspective</div>
                                                <div> TBD = Match not yet played</div>
                                            </div>
                                        </div>

                                        <div className="mt-4 text-xs text-purple-200 text-center">
                                            Scroll horizontally to see all teams
                                        </div>
                                    </div>
                                )}

                                {/* VISUALIZATION */}
                                {activeTab === 'visualization' && (
                                    <div>
                                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4">
                                            <h3 className="text-white font-semibold text-lg flex items-center gap-2">
                                                <ChartLine />
                                                Points Progression by Matchday
                                            </h3>
                                            
                                            <div className="flex flex-wrap gap-2">
                                                {/* Season Toggle */}
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            setSelectedSeason('current');
                                                            setSelectedTeam('all');
                                                        }}
                                                        className={`px-4 py-2 rounded text-sm font-medium ${
                                                            selectedSeason === 'current' 
                                                                ? 'bg-purple-700 text-white' 
                                                                : 'bg-white/10 text-white hover:bg-white/20'
                                                        }`}
                                                    >
                                                        Current Season
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            setSelectedSeason('last');
                                                            setSelectedTeam('all');
                                                        }}
                                                        className={`px-4 py-2 rounded text-sm font-medium ${
                                                            selectedSeason === 'last' 
                                                                ? 'bg-purple-700 text-white' 
                                                                : 'bg-white/10 text-white hover:bg-white/20'
                                                        }`}
                                                        disabled={lastSeasonData.standings.length === 0}
                                                    >
                                                        Last Season
                                                    </button>
                                                </div>
                                                
                                                {/* Team Filter */}
                                                <select
                                                    value={selectedTeam}
                                                    onChange={(e) => setSelectedTeam(e.target.value)}
                                                    className="px-4 py-2 rounded text-sm bg-white/10 text-white border border-purple-600 hover:bg-white/20"
                                                    style={{ color: 'white' }}
                                                >
                                                    <option value="all" style={{ background: '#1e1b4b', color: 'white' }}>All Teams</option>
                                                    {(selectedSeason === 'current' ? standings : lastSeasonData.standings)
                                                        .sort((a, b) => a.team.shortName.localeCompare(b.team.shortName))
                                                        .map(team => (
                                                            <option key={team.team.id} value={team.team.id} style={{ background: '#1e1b4b', color: 'white' }}>
                                                                {team.team.shortName}
                                                            </option>
                                                        ))
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        
                                        {lastSeasonData.standings.length === 0 && selectedSeason === 'last' && (
                                            <div className="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4 mb-4 text-white">
                                                <div className="text-sm">Last season data is not available. This requires backend support.</div>
                                            </div>
                                        )}
                                        
                                        <div className="bg-white/10 rounded-lg p-4">
                                            <div style={{ height: '500px' }}>
                                                <canvas ref={chartRef}></canvas>
                                            </div>
                                        </div>
                                        
                                        {selectedTeam !== 'all' && (
                                            <div className="mt-4 text-sm text-white bg-purple-800/50 rounded-lg p-3">
                                                <div className="font-semibold mb-1">
                                                    Viewing: {(selectedSeason === 'current' ? standings : lastSeasonData.standings)
                                                        .find(t => t.team.id === selectedTeam)?.team.shortName}
                                                </div>
                                                <div className="text-xs text-purple-200">
                                                    Other teams are hidden. Select "All Teams" to view the full chart.
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div className="mt-4 text-xs text-purple-200 text-center">
                                            Track how each team's points accumulate throughout the season
                                        </div>

                                        {/* YEAR OVER YEAR COMPARISON */}
                                        <div className="mt-12 border-t border-purple-700 pt-8">
                                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4">
                                                <h3 className="text-white font-semibold text-lg flex items-center gap-2">
                                                    <ChartLine />
                                                    Year over Year Comparison
                                                </h3>
                                                
                                                <div className="flex gap-2 items-center">
                                                    <span className="text-white text-sm">Select Team:</span>
                                                    <select
                                                        value={yoySelectedTeam}
                                                        onChange={(e) => setYoySelectedTeam(e.target.value)}
                                                        className="px-4 py-2 rounded text-sm bg-white/10 text-white border border-purple-600 hover:bg-white/20"
                                                        style={{ color: 'white' }}
                                                    >
                                                        {standings
                                                            .sort((a, b) => a.team.shortName.localeCompare(b.team.shortName))
                                                            .map(team => (
                                                                <option key={team.team.id} value={team.team.id} style={{ background: '#1e1b4b', color: 'white' }}>
                                                                    {team.team.shortName}
                                                                </option>
                                                            ))
                                                        }
                                                    </select>
                                                </div>
                                            </div>

                                            {lastSeasonData.standings.length === 0 ? (
                                                <div className="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4 text-white">
                                                    <div className="text-sm">Last season data is not available. This requires backend support.</div>
                                                </div>
                                            ) : (
                                                <>
                                                    <div className="bg-white/10 rounded-lg p-4">
                                                        <div style={{ height: '400px' }}>
                                                            <canvas ref={yoyChartRef}></canvas>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="mt-4 text-sm text-white bg-purple-800/50 rounded-lg p-3">
                                                        <div className="font-semibold mb-2">Reading the Chart:</div>
                                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs">
                                                            <div> <span className="text-purple-300">Solid line</span>: Current season progress</div>
                                                            <div> <span className="text-gray-400">Dashed line</span>: Last season for comparison</div>
                                                            <div> Higher line = Better performance</div>
                                                            <div> Steeper slope = More points gained recently</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="mt-4 text-xs text-purple-200 text-center">
                                                        Compare how the selected team is performing this season versus last season
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {/* SCENARIO PLANNING */}
                                {activeTab === 'scenarios' && (
                                    <div>
                                        <div className="mb-6">
                                            <h3 className="text-white font-semibold text-xl mb-2 flex items-center gap-2">
                                                <Calculator />
                                                Season Scenario Planning
                                            </h3>
                                            <p className="text-purple-200 text-sm">
                                                Project final standings based on different scenarios for remaining matches
                                            </p>
                                        </div>

                                        <div className="mb-6 bg-white/10 rounded-lg p-4">
                                            <div className="text-white font-semibold mb-3">Select Scenario:</div>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                                <button
                                                    onClick={() => setScenarioType('current_form')}
                                                    className={`p-3 rounded-lg text-left transition-all ${
                                                        scenarioType === 'current_form' 
                                                            ? 'bg-purple-700 text-white shadow-lg' 
                                                            : 'bg-white/5 text-purple-200 hover:bg-white/10'
                                                    }`}
                                                >
                                                    <div className="font-semibold mb-1">Current Form</div>
                                                    <div className="text-xs opacity-80">
                                                        Teams maintain their current PPG
                                                    </div>
                                                </button>
                                                
                                                <button
                                                    onClick={() => setScenarioType('recent_form')}
                                                    className={`p-3 rounded-lg text-left transition-all ${
                                                        scenarioType === 'recent_form' 
                                                            ? 'bg-purple-700 text-white shadow-lg' 
                                                            : 'bg-white/5 text-purple-200 hover:bg-white/10'
                                                    }`}
                                                >
                                                    <div className="font-semibold mb-1">Recent Form</div>
                                                    <div className="text-xs opacity-80">
                                                        Based on last 5 matches
                                                    </div>
                                                </button>

                                                <button
                                                    onClick={() => setScenarioType('home_away_form')}
                                                    className={`p-3 rounded-lg text-left transition-all ${
                                                        scenarioType === 'home_away_form' 
                                                            ? 'bg-purple-700 text-white shadow-lg' 
                                                            : 'bg-white/5 text-purple-200 hover:bg-white/10'
                                                    }`}
                                                >
                                                    <div className="font-semibold mb-1">Home/Away Form</div>
                                                    <div className="text-xs opacity-80">
                                                        Based on actual home/away records
                                                    </div>
                                                </button>
                                            </div>
                                        </div>

                                        {projectedStandings.length > 0 && (
                                            <div className="bg-white/10 rounded-lg overflow-hidden">
                                                <div className="bg-purple-900/50 text-white text-xs font-semibold border-b border-purple-700">
                                                    <div className="grid grid-cols-12 gap-2 px-3 py-2">
                                                        <div className="col-span-1 text-center">#</div>
                                                        <div className="col-span-3">Team</div>
                                                        <div className="col-span-1 text-center">Current</div>
                                                        <div className="col-span-1 text-center">Change</div>
                                                        <div className="col-span-1 text-center">Games</div>
                                                        <div className="col-span-1 text-center">Proj Pts</div>
                                                        <div className="col-span-1 text-center">+/-</div>
                                                        <div className="col-span-1 text-center">Proj GF</div>
                                                        <div className="col-span-1 text-center">Proj GA</div>
                                                        <div className="col-span-1 text-center">Proj GD</div>
                                                    </div>
                                                </div>
                                                {projectedStandings.map((team, idx) => {
                                                    return (
                                                        <div 
                                                            key={idx}
                                                            className="grid grid-cols-12 gap-2 px-3 py-2 text-white text-sm border-b border-purple-800/30 items-center hover:bg-white/5"
                                                        >
                                                            <div className={`col-span-1 text-center font-bold ${
                                                                team.projectedPosition <= 4 ? 'text-green-400' : 
                                                                team.projectedPosition === 5 ? 'text-blue-400' :
                                                                team.projectedPosition >= 18 ? 'text-red-400' : 'text-purple-300'
                                                            }`}>
                                                                {team.projectedPosition}
                                                            </div>
                                                            <div className="col-span-3 flex items-center gap-2">
                                                                {team.team.crest && <img src={team.team.crest} alt="" className="w-5 h-5 object-contain" />}
                                                                <div className="flex-1">
                                                                    <div className="text-xs font-semibold truncate">{team.team.shortName}</div>
                                                                </div>
                                                            </div>
                                                            <div className="col-span-1 text-center text-xs text-purple-300">
                                                                {team.position}
                                                            </div>
                                                            <div className="col-span-1 text-center text-xs">
                                                                {team.positionChange > 0 && (
                                                                    <span className="text-green-400">{team.positionChange}</span>
                                                                )}
                                                                {team.positionChange < 0 && (
                                                                    <span className="text-red-400">{Math.abs(team.positionChange)}</span>
                                                                )}
                                                                {team.positionChange === 0 && (
                                                                    <span className="text-gray-400">-</span>
                                                                )}
                                                            </div>
                                                            <div className="col-span-1 text-center text-xs text-purple-300">
                                                                {team.remainingGames}
                                                            </div>
                                                            <div className="col-span-1 text-center font-bold text-xs text-yellow-400">
                                                                {team.projectedPoints}
                                                            </div>
                                                            <div className="col-span-1 text-center text-xs">
                                                                <span className={team.pointsGain > 0 ? 'text-green-400' : team.pointsGain < 0 ? 'text-red-400' : 'text-gray-400'}>
                                                                    {team.pointsGain > 0 ? '+' : ''}{team.pointsGain}
                                                                </span>
                                                            </div>
                                                            <div className="col-span-1 text-center text-xs text-green-400">
                                                                {team.projectedGF}
                                                            </div>
                                                            <div className="col-span-1 text-center text-xs text-red-400">
                                                                {team.projectedGA}
                                                            </div>
                                                            <div className="col-span-1 text-center text-xs">
                                                                {team.projectedGD > 0 ? '+' : ''}{team.projectedGD}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}

                                        <div className="mt-6 bg-purple-800/30 rounded-lg p-4 text-white">
                                            <div className="text-sm font-semibold mb-2">Legend:</div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs">
                                                <div> <span className="text-green-400">Green positions</span>: Champions League</div>
                                                <div> <span className="text-blue-400">Blue position</span>: Europa League</div>
                                                <div> <span className="text-red-400">Red positions</span>: Relegation zone</div>
                                                <div> <span className="text-yellow-400">Proj Pts</span>: Projected final points</div>
                                                <div> <span className="text-green-400"></span>: Moving up in standings</div>
                                                <div> <span className="text-red-400"></span>: Moving down in standings</div>
                                            </div>
                                        </div>

                                        <div className="mt-4 text-xs text-purple-200 text-center">
                                            Note: Projections are estimates based on the selected scenario. Actual results will vary.
                                        </div>
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
